name: Continuous Integration
on:
    push:
jobs:
    build-project:
        name: Continuous integration
        runs-on: ubuntu-24.04
        steps:
            - name: Checkout Project
              uses: actions/checkout@v4.2.2
            - name: Setup cmake
              uses: jwlawson/actions-setup-cmake@v2
              with:
                cmake-version: '3.31.x'
            - name: Setup LCOV
              uses: hrishikesh-kadam/setup-lcov@v1
            - name: Setup CPP compiler
              id: setup_compiler
              uses: rlalik/setup-cpp-compiler@master
              with:
                compiler: latest
            - name: Setup Python
              uses: actions/setup-python@v1
            - name: Setup pip with cpplint package
              uses: BSFishy/pip-action@v1
              with:
                packages: cpplint
                extra: --user
            - name: Generates the makefile
              run: |
                cmake . -DCMAKE_BUILD_TYPE=Debug -DENABLE_COVERAGE=OFF ;
                cmake --build .
            - name: Check for lint errors
              run: make lint
            - name: Run unit tests
              run: |
                make tests ; ./out/bin/tests
            - name: Generates coverage
              run: make cov_gen
            - name: Report coverage
              uses: zgosalvez/github-actions-report-lcov@v4
              with:
                coverage-files: cov_result.info
                minimum-coverage: 90
                working-directory: src/lib