name: Continuous Integration
on:
    pull_request:
jobs:
    build-project:
        name: Continuous integration - Unit test code coverage
        runs-on: ubuntu-24.04
        steps:
            - name: Checkout Project
              uses: actions/checkout@v4.2.2
            - name: Setup cmake
              uses: jwlawson/actions-setup-cmake@v2
              with:
                cmake-version: '3.31.x'
            - name: Setup LCOV
              uses: hrishikesh-kadam/setup-lcov@v1
            - name: Setup CPP compiler
              id: setup_compiler
              uses: rlalik/setup-cpp-compiler@master
              with:
                compiler: latest
            - name: Setup Python
              uses: actions/setup-python@v1
            - name: Generates the makefile
              run: |
                cmake . -DCMAKE_BUILD_TYPE=Debug -DENABLE_COVERAGE=OFF ;
                cmake --build . --config Debug
            - name: Run unit tests
              run: |
                make tests ; ./out/bin/tests
            - name: Generates coverage
              run: lcov --directory src/libs/ --capture --output-file cov_result.info
            - name: Enfore coverage
              run : python utils/coverage.py